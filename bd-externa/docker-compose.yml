services:
  mysql-external:
    image: mysql:8.0
    container_name: mysql-external
    environment:
      MYSQL_ROOT_PASSWORD: RootPassword2025!
      MYSQL_DATABASE: external_db
      MYSQL_USER: external_user
      MYSQL_PASSWORD: ExternalPassword2025!
    volumes:
      - mysql_external_data:/var/lib/mysql
    restart: unless-stopped
    command: --default-authentication-plugin=mysql_native_password
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      
      # Router HTTPS
      - "traefik.http.routers.mysql-external.rule=Host(`bd-mysql.jvserver.com`)"
      - "traefik.http.routers.mysql-external.entrypoints=websecure"
      - "traefik.http.routers.mysql-external.tls=true"
      - "traefik.http.routers.mysql-external.tls.certresolver=myresolver"
      
      # Servicio TCP para MySQL (puerto 3306)
      - "traefik.tcp.routers.mysql-external-tcp.rule=HostSNI(`bd-mysql.jvserver.com`)"
      - "traefik.tcp.routers.mysql-external-tcp.entrypoints=mysql-port"
      - "traefik.tcp.routers.mysql-external-tcp.tls=true"
      - "traefik.tcp.routers.mysql-external-tcp.tls.certresolver=myresolver"
      - "traefik.tcp.services.mysql-external-tcp.loadbalancer.server.port=3306"

volumes:
  mysql_external_data:

networks:
  proxy:
    external: true
